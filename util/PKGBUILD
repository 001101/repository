# Maintainer: Sean Enck <enckse@gmail.com>
pkgname=epiphyte-build
pkgrel=1
pkgdesc="epiphyte package build helpers"
url="https://github.com/epiphyte/repository"
license=('MIT')
makedepends=('git' 'pandoc')
optdepends=('pandoc: package html generation'
            'devtools: development tools for arch')
source=("git+$url")
sha512sums=('SKIP')

build() {
    cd ${srcdir}/repository
    pandoc README.md --out util/readme.html
    cd util
    _archs=$(cat epiphyte-package.sh | grep "[a-zA-Z0-9]\_arch=\"" | sed "s/^.*arch=//g;s/\"//g" | tr '\n' ' ')
    sed -i "s/COMPLETIONS/$_archs/g" completions.epiphyte-package
}

package() {

    cd ${srcdir}/repository/util
    install -Dm 755 epiphyte-package.sh $pkgdir/usr/local/bin/epiphyte-package
    install -Dm 755 epiphyte-deploy.sh $pkgdir/usr/local/bin/epiphyte-deploy
    install -Dm 644 package.css $pkgdir/opt/epiphyte/epiphyte-build/package.css
    install -Dm 644 package.js $pkgdir/opt/epiphyte/epiphyte-build/package.js
    install -Dm 644 readme.html $pkgdir/opt/epiphyte/epiphyte-build/readme.html
    install -Dm 644 completions.epiphyte-package $pkgdir/usr/share/bash-completion/completions/epiphyte-package
    install -Dm 644 LICENSE $pkgdir/usr/share/licenses/$pkgname/LICENSE
}

